
DevTools listening on ws://127.0.0.1:37357/devtools/browser/995f714e-2c0d-4386-ba93-0bb421f10709

================================================================================

  (Run Starting)

  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
  │ Cypress:        15.0.0                                                                         │
  │ Browser:        Electron 136 (headless)                                                        │
  │ Node Version:   v22.19.0 (/home/karol/.nvm/versions/node/v22.19.0/bin/node)                    │
  │ Specs:          1 found (apiClient.cy.ts)                                                      │
  │ Searched:       cypress/e2e/apiClient.cy.ts                                                    │
  └────────────────────────────────────────────────────────────────────────────────────────────────┘


────────────────────────────────────────────────────────────────────────────────────────────────────
                                                                                                    
  Running:  apiClient.cy.ts                                                                 (1 of 1)
{
  "stats": {
    "suites": 1,
    "tests": 2,
    "passes": 0,
    "pending": 0,
    "failures": 2,
    "start": "2025-09-03T05:49:09.015Z",
    "end": "2025-09-03T05:49:14.685Z",
    "duration": 5670
  },
  "tests": [
    {
      "title": "should refresh token against the mock backend and retry the request",
      "fullTitle": "API Client Token Refresh should refresh token against the mock backend and retry the request",
      "file": null,
      "duration": 5297,
      "currentRetry": 0,
      "err": {
        "message": "Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'",
        "name": "AssertionError",
        "stack": "AssertionError: Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'\n    at Context.eval (webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts:34:15)\n    at getRet (http://localhost:3003/__cypress/runner/cypress_runner.js:120768:20)\n    at tryCatcher (http://localhost:3003/__cypress/runner/cypress_runner.js:1777:23)\n    at Promise.attempt.Promise.try (http://localhost:3003/__cypress/runner/cypress_runner.js:4285:29)\n    at Context.thenFn (http://localhost:3003/__cypress/runner/cypress_runner.js:120779:66)\n    at Context.then (http://localhost:3003/__cypress/runner/cypress_runner.js:121030:21)\n    at wrapped (http://localhost:3003/__cypress/runner/cypress_runner.js:141618:19)",
        "parsedStack": [
          {
            "message": "AssertionError: Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'",
            "whitespace": ""
          },
          {
            "function": "Context.eval",
            "fileUrl": "http://localhost:3003/__cypress/tests?p=cypress/e2e/apiClient.cy.ts",
            "originalFile": "webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts",
            "relativeFile": "cypress/e2e/apiClient.cy.ts",
            "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
            "line": 34,
            "column": 15,
            "whitespace": "    "
          },
          {
            "function": "getRet",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120768,
            "column": 20,
            "whitespace": "    "
          },
          {
            "function": "tryCatcher",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 1777,
            "column": 23,
            "whitespace": "    "
          },
          {
            "function": "Promise.attempt.Promise.try",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 4285,
            "column": 29,
            "whitespace": "    "
          },
          {
            "function": "Context.thenFn",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120779,
            "column": 66,
            "whitespace": "    "
          },
          {
            "function": "Context.then",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 121030,
            "column": 21,
            "whitespace": "    "
          },
          {
            "function": "wrapped",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 141618,
            "column": 19,
            "whitespace": "    "
          }
        ],
        "codeFrame": {
          "line": 34,
          "column": 16,
          "originalFile": "cypress/e2e/apiClient.cy.ts",
          "relativeFile": "frontend/cypress/e2e/apiClient.cy.ts",
          "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
          "frame": "  32 |       \n  33 |       // Wait for successful login and navigation\n> 34 |       cy.url().should('include', '/dashboard', { timeout: 10000 });\n     |                ^\n  35 |       \n  36 |       // Now manually expire the access token to trigger refresh flow\n  37 |       cy.window().then((win) => {",
          "language": "ts"
        }
      }
    },
    {
      "title": "should handle refresh token failure and redirect to login",
      "fullTitle": "API Client Token Refresh should handle refresh token failure and redirect to login",
      "file": null,
      "duration": 317,
      "currentRetry": 0,
      "err": {
        "message": "expected 'expired-token' to be null",
        "name": "AssertionError",
        "stack": "AssertionError: expected 'expired-token' to be null\n    at Object.proxyGetter [as get] (http://localhost:3003/__cypress/runner/cypress_runner.js:80426:22)\n    at Context.eval (webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts:98:61)\n    at getRet (http://localhost:3003/__cypress/runner/cypress_runner.js:120768:20)\n    at tryCatcher (http://localhost:3003/__cypress/runner/cypress_runner.js:1777:23)\n    at Promise.attempt.Promise.try (http://localhost:3003/__cypress/runner/cypress_runner.js:4285:29)",
        "parsedStack": [
          {
            "message": "AssertionError: expected 'expired-token' to be null",
            "whitespace": ""
          },
          {
            "function": "Object.proxyGetter [as get]",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 80426,
            "column": 22,
            "whitespace": "    "
          },
          {
            "function": "Context.eval",
            "fileUrl": "http://localhost:3003/__cypress/tests?p=cypress/e2e/apiClient.cy.ts",
            "originalFile": "webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts",
            "relativeFile": "cypress/e2e/apiClient.cy.ts",
            "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
            "line": 98,
            "column": 61,
            "whitespace": "    "
          },
          {
            "function": "getRet",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120768,
            "column": 20,
            "whitespace": "    "
          },
          {
            "function": "tryCatcher",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 1777,
            "column": 23,
            "whitespace": "    "
          },
          {
            "function": "Promise.attempt.Promise.try",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 4285,
            "column": 29,
            "whitespace": "    "
          }
        ]
      }
    }
  ],
  "pending": [],
  "failures": [
    {
      "title": "should refresh token against the mock backend and retry the request",
      "fullTitle": "API Client Token Refresh should refresh token against the mock backend and retry the request",
      "file": null,
      "currentRetry": 0,
      "err": {
        "message": "Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'",
        "name": "AssertionError",
        "stack": "AssertionError: Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'\n    at Context.eval (webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts:34:15)\n    at getRet (http://localhost:3003/__cypress/runner/cypress_runner.js:120768:20)\n    at tryCatcher (http://localhost:3003/__cypress/runner/cypress_runner.js:1777:23)\n    at Promise.attempt.Promise.try (http://localhost:3003/__cypress/runner/cypress_runner.js:4285:29)\n    at Context.thenFn (http://localhost:3003/__cypress/runner/cypress_runner.js:120779:66)\n    at Context.then (http://localhost:3003/__cypress/runner/cypress_runner.js:121030:21)\n    at wrapped (http://localhost:3003/__cypress/runner/cypress_runner.js:141618:19)",
        "parsedStack": [
          {
            "message": "AssertionError: Timed out retrying after 4000ms: [object Object]: expected 'http://localhost:3003/login' to include '/dashboard'",
            "whitespace": ""
          },
          {
            "function": "Context.eval",
            "fileUrl": "http://localhost:3003/__cypress/tests?p=cypress/e2e/apiClient.cy.ts",
            "originalFile": "webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts",
            "relativeFile": "cypress/e2e/apiClient.cy.ts",
            "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
            "line": 34,
            "column": 15,
            "whitespace": "    "
          },
          {
            "function": "getRet",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120768,
            "column": 20,
            "whitespace": "    "
          },
          {
            "function": "tryCatcher",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 1777,
            "column": 23,
            "whitespace": "    "
          },
          {
            "function": "Promise.attempt.Promise.try",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 4285,
            "column": 29,
            "whitespace": "    "
          },
          {
            "function": "Context.thenFn",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120779,
            "column": 66,
            "whitespace": "    "
          },
          {
            "function": "Context.then",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 121030,
            "column": 21,
            "whitespace": "    "
          },
          {
            "function": "wrapped",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 141618,
            "column": 19,
            "whitespace": "    "
          }
        ],
        "codeFrame": {
          "line": 34,
          "column": 16,
          "originalFile": "cypress/e2e/apiClient.cy.ts",
          "relativeFile": "frontend/cypress/e2e/apiClient.cy.ts",
          "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
          "frame": "  32 |       \n  33 |       // Wait for successful login and navigation\n> 34 |       cy.url().should('include', '/dashboard', { timeout: 10000 });\n     |                ^\n  35 |       \n  36 |       // Now manually expire the access token to trigger refresh flow\n  37 |       cy.window().then((win) => {",
          "language": "ts"
        }
      }
    },
    {
      "title": "should handle refresh token failure and redirect to login",
      "fullTitle": "API Client Token Refresh should handle refresh token failure and redirect to login",
      "file": null,
      "currentRetry": 0,
      "err": {
        "message": "expected 'expired-token' to be null",
        "name": "AssertionError",
        "stack": "AssertionError: expected 'expired-token' to be null\n    at Object.proxyGetter [as get] (http://localhost:3003/__cypress/runner/cypress_runner.js:80426:22)\n    at Context.eval (webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts:98:61)\n    at getRet (http://localhost:3003/__cypress/runner/cypress_runner.js:120768:20)\n    at tryCatcher (http://localhost:3003/__cypress/runner/cypress_runner.js:1777:23)\n    at Promise.attempt.Promise.try (http://localhost:3003/__cypress/runner/cypress_runner.js:4285:29)",
        "parsedStack": [
          {
            "message": "AssertionError: expected 'expired-token' to be null",
            "whitespace": ""
          },
          {
            "function": "Object.proxyGetter [as get]",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 80426,
            "column": 22,
            "whitespace": "    "
          },
          {
            "function": "Context.eval",
            "fileUrl": "http://localhost:3003/__cypress/tests?p=cypress/e2e/apiClient.cy.ts",
            "originalFile": "webpack://frontend-tmp/./cypress/e2e/apiClient.cy.ts",
            "relativeFile": "cypress/e2e/apiClient.cy.ts",
            "absoluteFile": "/home/karol/dev/code/fridgr/frontend/cypress/e2e/apiClient.cy.ts",
            "line": 98,
            "column": 61,
            "whitespace": "    "
          },
          {
            "function": "getRet",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 120768,
            "column": 20,
            "whitespace": "    "
          },
          {
            "function": "tryCatcher",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 1777,
            "column": 23,
            "whitespace": "    "
          },
          {
            "function": "Promise.attempt.Promise.try",
            "fileUrl": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "originalFile": "http://localhost:3003/__cypress/runner/cypress_runner.js",
            "line": 4285,
            "column": 29,
            "whitespace": "    "
          }
        ]
      }
    }
  ],
  "passes": []
}
  (Results)

  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
  │ Tests:        2                                                                                │
  │ Passing:      0                                                                                │
  │ Failing:      2                                                                                │
  │ Pending:      0                                                                                │
  │ Skipped:      0                                                                                │
  │ Screenshots:  2                                                                                │
  │ Video:        false                                                                            │
  │ Duration:     5 seconds                                                                        │
  │ Spec Ran:     apiClient.cy.ts                                                                  │
  └────────────────────────────────────────────────────────────────────────────────────────────────┘


  (Screenshots)

  -  /home/karol/dev/code/fridgr/frontend/cypress/screenshots/apiClient.cy.ts/API Cli     (1280x720)
     ent Token Refresh -- should refresh token against the mock backend and retry the               
      request (failed).png                                                                          
  -  /home/karol/dev/code/fridgr/frontend/cypress/screenshots/apiClient.cy.ts/API Cli     (1280x720)
     ent Token Refresh -- should handle refresh token failure and redirect to login (               
     failed).png                                                                                    


================================================================================

  (Run Finished)


       Spec                                              Tests  Passing  Failing  Pending  Skipped  
  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐
  │ ✖  apiClient.cy.ts                          00:05        2        -        2        -        - │
  └────────────────────────────────────────────────────────────────────────────────────────────────┘
    ✖  1 of 1 failed (100%)                     00:05        2        -        2        -        -  

